<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mobile Shop Management System</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>ðŸ“± Mobile Shop Management System</h1>
            <div class="nav-tabs">
                <button class="nav-tab active" onclick="showTab('dashboard')">Dashboard</button>
                <button class="nav-tab" onclick="showTab('inventory')">Inventory</button>
                <button class="nav-tab" onclick="showTab('sales')">Sales</button>
                <button class="nav-tab" onclick="showTab('reports')">Reports</button>
                <button class="nav-tab" onclick="showTab('suppliers')">Suppliers</button>
            </div>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <div class="stats-grid">
                <div class="stat-card">
                    <h3 id="totalProducts">0</h3>
                    <p>Total Products</p>
                </div>
                <div class="stat-card">
                    <h3 id="todaySales">$0</h3>
                    <p>Today's Sales</p>
                </div>
                <div class="stat-card">
                    <h3 id="monthSales">$0</h3>
                    <p>Monthly Sales</p>
                </div>
                <div class="stat-card">
                    <h3 id="totalProfit">$0</h3>
                    <p>Total Profit</p>
                </div>
            </div>

            <h2>Recent Sales</h2>
            <div class="table-container">
                <table id="recentSalesTable">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Product</th>
                            <th>Customer</th>
                            <th>Quantity</th>
                            <th>Amount</th>
                            <th>Profit</th>
                        </tr>
                    </thead>
                    <tbody id="recentSalesBody">
                    </tbody>
                </table>
            </div>

            <h2 style="margin-top: 30px;">Low Stock Alerts</h2>
            <div class="table-container">
                <table id="lowStockTable">
                    <thead>
                        <tr>
                            <th>Product</th>
                            <th>Brand</th>
                            <th>Current Stock</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="lowStockBody">
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Inventory Tab -->
        <div id="inventory" class="tab-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2>Inventory Management</h2>
                <button class="btn btn-primary" onclick="showAddProductModal()">Add New Product</button>
            </div>

            <div class="search-container">
                <input type="text" id="productSearch" placeholder="Search products..." oninput="searchProducts()">
            </div>

            <div class="table-container">
                <table id="inventoryTable">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Product Name</th>
                            <th>Brand</th>
                            <th>Category</th>
                            <th>Stock</th>
                            <th>Purchase Price</th>
                            <th>Selling Price</th>
                            <th>Profit</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="inventoryBody">
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Sales Tab -->
        <div id="sales" class="tab-content">
            <h2>Make a Sale</h2>

            <div class="form-group">
                <div class="form-row">
                    <div class="form-col">
                        <label for="saleProduct">Select Product:</label>
                        <select id="saleProduct" onchange="updateSalePrice()">
                            <option value="">Choose a product...</option>
                        </select>
                    </div>
                    <div class="form-col">
                        <label for="saleQuantity">Quantity:</label>
                        <input type="number" id="saleQuantity" min="1" value="1" onchange="updateSaleTotal()">
                    </div>
                </div>
            </div>

            <div class="form-group">
                <div class="form-row">
                    <div class="form-col">
                        <label for="salePrice">Unit Price:</label>
                        <input type="number" id="salePrice" step="0.01" onchange="updateSaleTotal()">
                    </div>
                    <div class="form-col">
                        <label for="saleTotal">Total Amount:</label>
                        <input type="number" id="saleTotal" readonly>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <div class="form-row">
                    <div class="form-col">
                        <label for="customerName">Customer Name:</label>
                        <input type="text" id="customerName" placeholder="Enter customer name">
                    </div>
                    <div class="form-col">
                        <label for="customerPhone">Customer Phone:</label>
                        <input type="tel" id="customerPhone" placeholder="Enter phone number">
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label for="saleNotes">Notes:</label>
                <textarea id="saleNotes" rows="3" placeholder="Additional notes about the sale..."></textarea>
            </div>

            <button class="btn btn-success" onclick="processSale()">Complete Sale</button>
        </div>

        <!-- Reports Tab -->
        <div id="reports" class="tab-content">
            <h2>Sales Reports</h2>

            <div class="form-group">
                <div class="form-row">
                    <div class="form-col">
                        <label for="reportType">Report Type:</label>
                        <select id="reportType" onchange="generateReport()">
                            <option value="daily">Daily Sales</option>
                            <option value="monthly">Monthly Sales</option>
                            <option value="yearly">Yearly Sales</option>
                            <option value="profit">Profit Analysis</option>
                        </select>
                    </div>
                    <div class="form-col">
                        <label for="reportDate">Date:</label>
                        <input type="date" id="reportDate" onchange="generateReport()">
                    </div>
                </div>
            </div>

            <div id="reportContent">
                <!-- Report content will be populated here -->
            </div>
        </div>

        <!-- Suppliers Tab -->
        <div id="suppliers" class="tab-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2>Suppliers</h2>
                <button class="btn btn-primary" onclick="showAddSupplierModal()">Add New Supplier</button>
            </div>

            <div class="table-container">
                <table id="suppliersTable">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Contact</th>
                            <th>Email</th>
                            <th>Products Supplied</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="suppliersBody">
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Add Product Modal -->
    <div id="addProductModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('addProductModal')">&times;</span>
            <h2>Add New Product</h2>

            <div class="form-group">
                <label for="productName">Product Name:</label>
                <input type="text" id="productName" required>
            </div>

            <div class="form-group">
                <div class="form-row">
                    <div class="form-col">
                        <label for="productBrand">Brand:</label>
                        <input type="text" id="productBrand" required>
                    </div>
                    <div class="form-col">
                        <label for="productModel">Model:</label>
                        <input type="text" id="productModel">
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label for="productCategory">Category:</label>
                <select id="productCategory" required>
                    <option value="">Select Category</option>
                    <option value="New Mobile">New Mobile</option>
                    <option value="Used Mobile">Used Mobile</option>
                    <option value="Charger">Charger</option>
                    <option value="Screen Protector">Screen Protector</option>
                    <option value="Battery">Battery</option>
                    <option value="Case">Case</option>
                    <option value="Headphones">Headphones</option>
                    <option value="Earbuds">Earbuds</option>
                    <option value="Speaker">Speaker</option>
                    <option value="Other">Other</option>
                </select>
            </div>

            <div class="form-group">
                <div class="form-row">
                    <div class="form-col">
                        <label for="productQuantity">Quantity:</label>
                        <input type="number" id="productQuantity" min="0" required>
                    </div>
                    <div class="form-col">
                        <label for="productSupplier">Supplier:</label>
                        <select id="productSupplier">
                            <option value="">Select Supplier</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <div class="form-row">
                    <div class="form-col">
                        <label for="productPurchasePrice">Purchase Price:</label>
                        <input type="number" id="productPurchasePrice" step="0.01" required>
                    </div>
                    <div class="form-col">
                        <label for="productSellingPrice">Selling Price:</label>
                        <input type="number" id="productSellingPrice" step="0.01" required>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label for="productDescription">Description:</label>
                <textarea id="productDescription" rows="3"></textarea>
            </div>

            <button class="btn btn-primary" onclick="addProduct()">Add Product</button>
        </div>
    </div>

    <!-- Add Supplier Modal -->
    <div id="addSupplierModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('addSupplierModal')">&times;</span>
            <h2>Add New Supplier</h2>

            <div class="form-group">
                <label for="supplierName">Supplier Name:</label>
                <input type="text" id="supplierName" required>
            </div>

            <div class="form-group">
                <div class="form-row">
                    <div class="form-col">
                        <label for="supplierContact">Contact:</label>
                        <input type="tel" id="supplierContact" required>
                    </div>
                    <div class="form-col">
                        <label for="supplierEmail">Email:</label>
                        <input type="email" id="supplierEmail">
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label for="supplierAddress">Address:</label>
                <textarea id="supplierAddress" rows="3"></textarea>
            </div>

            <div class="form-group">
                <label for="supplierProducts">Products Supplied:</label>
                <input type="text" id="supplierProducts" placeholder="e.g., Mobiles, Chargers, Accessories">
            </div>

            <button class="btn btn-primary" onclick="addSupplier()">Add Supplier</button>
        </div>
    </div>

    <script>
        // Global variables
        let products = [];
        let sales = [];
        let suppliers = [];
        let customers = [];
        let productIdCounter = 1;
        let supplierIdCounter = 1;
        let saleIdCounter = 1;
        let customerIdCounter = 1;

        // Utility: Save/load data from localStorage
        function saveData() {
            localStorage.setItem('products', JSON.stringify(products));
            localStorage.setItem('sales', JSON.stringify(sales));
            localStorage.setItem('suppliers', JSON.stringify(suppliers));
            localStorage.setItem('customers', JSON.stringify(customers));
            localStorage.setItem('productIdCounter', productIdCounter);
            localStorage.setItem('supplierIdCounter', supplierIdCounter);
            localStorage.setItem('saleIdCounter', saleIdCounter);
            localStorage.setItem('customerIdCounter', customerIdCounter);
        }
        function loadData() {
            products = JSON.parse(localStorage.getItem('products') || '[]');
            sales = JSON.parse(localStorage.getItem('sales') || '[]');
            suppliers = JSON.parse(localStorage.getItem('suppliers') || '[]');
            customers = JSON.parse(localStorage.getItem('customers') || '[]');
            productIdCounter = parseInt(localStorage.getItem('productIdCounter') || '1');
            supplierIdCounter = parseInt(localStorage.getItem('supplierIdCounter') || '1');
            saleIdCounter = parseInt(localStorage.getItem('saleIdCounter') || '1');
            customerIdCounter = parseInt(localStorage.getItem('customerIdCounter') || '1');
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', function () {
            if (localStorage.getItem('products')) {
                loadData();
            } else {
                loadSampleData();
                saveData();
            }
            updateDashboard();
            updateInventoryTable();
            updateSalesDropdown();
            updateSuppliersDropdown();
            updateSuppliersTable();
            generateReport();
            document.getElementById('reportDate').value = new Date().toISOString().split('T')[0];
        });

        // Load sample data
        function loadSampleData() {
            suppliers = [
                { id: 1, name: 'TechWorld Suppliers', contact: '+92-300-1234567', email: 'info@techworld.com', address: 'Karachi, Pakistan', products: 'Mobiles, Accessories' },
                { id: 2, name: 'Mobile Hub', contact: '+92-321-9876543', email: 'sales@mobilehub.com', address: 'Lahore, Pakistan', products: 'Chargers, Batteries' },
                { id: 3, name: 'Gadget Central', contact: '+92-333-5555555', email: 'orders@gadgetcentral.com', address: 'Islamabad, Pakistan', products: 'Audio Devices' }
            ];

            products = [
                { id: 1, name: 'iPhone 14', brand: 'Apple', model: 'iPhone 14', category: 'New Mobile', quantity: 5, purchasePrice: 800, sellingPrice: 950, supplier: 'TechWorld Suppliers', description: 'Latest iPhone model' },
                { id: 2, name: 'Samsung Galaxy S23', brand: 'Samsung', model: 'Galaxy S23', category: 'New Mobile', quantity: 3, purchasePrice: 700, sellingPrice: 850, supplier: 'TechWorld Suppliers', description: 'Flagship Samsung phone' },
                { id: 3, name: 'iPhone 12 (Used)', brand: 'Apple', model: 'iPhone 12', category: 'Used Mobile', quantity: 2, purchasePrice: 400, sellingPrice: 550, supplier: 'TechWorld Suppliers', description: 'Good condition used iPhone' },
                { id: 4, name: 'Fast Charger 25W', brand: 'Samsung', model: 'EP-TA800', category: 'Charger', quantity: 20, purchasePrice: 15, sellingPrice: 25, supplier: 'Mobile Hub', description: 'Original Samsung fast charger' },
                { id: 5, name: 'Tempered Glass', brand: 'Generic', model: 'Universal', category: 'Screen Protector', quantity: 50, purchasePrice: 2, sellingPrice: 5, supplier: 'Mobile Hub', description: 'Universal screen protector' },
                { id: 6, name: 'AirPods Pro', brand: 'Apple', model: 'AirPods Pro', category: 'Earbuds', quantity: 8, purchasePrice: 200, sellingPrice: 280, supplier: 'Gadget Central', description: 'Premium wireless earbuds' }
            ];

            sales = [
                { id: 1, productId: 1, productName: 'iPhone 14', customerName: 'Ahmed Ali', customerPhone: '+92-300-1111111', quantity: 1, unitPrice: 950, totalAmount: 950, profit: 150, date: '2025-07-13', notes: 'Cash payment' },
                { id: 2, productId: 4, productName: 'Fast Charger 25W', customerName: 'Sara Khan', customerPhone: '+92-321-2222222', quantity: 2, unitPrice: 25, totalAmount: 50, profit: 20, date: '2025-07-13', notes: 'Warranty included' },
                { id: 3, productId: 2, productName: 'Samsung Galaxy S23', customerName: 'Muhammad Hassan', customerPhone: '+92-333-3333333', quantity: 1, unitPrice: 850, totalAmount: 850, profit: 150, date: '2025-07-12', notes: 'Bank transfer' }
            ];

            productIdCounter = products.length + 1;
        }

        // Tab management
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            if (tabName === 'dashboard') updateDashboard();
            else if (tabName === 'inventory') updateInventoryTable();
            else if (tabName === 'reports') generateReport();
            else if (tabName === 'suppliers') updateSuppliersTable();
        }

        // Modal management
        function showAddProductModal(productId) {
            // If productId is provided, it's restock/edit
            if (productId) {
                const product = products.find(p => p.id === productId);
                if (product) {
                    document.getElementById('productName').value = product.name;
                    document.getElementById('productBrand').value = product.brand;
                    document.getElementById('productModel').value = product.model;
                    document.getElementById('productCategory').value = product.category;
                    document.getElementById('productQuantity').value = product.quantity;
                    document.getElementById('productSupplier').value = product.supplier;
                    document.getElementById('productPurchasePrice').value = product.purchasePrice;
                    document.getElementById('productSellingPrice').value = product.sellingPrice;
                    document.getElementById('productDescription').value = product.description;
                    document.getElementById('addProductModal').dataset.editId = productId;
                }
            } else {
                // Clear form for new product
                document.getElementById('productName').value = '';
                document.getElementById('productBrand').value = '';
                document.getElementById('productModel').value = '';
                document.getElementById('productCategory').value = '';
                document.getElementById('productQuantity').value = '';
                document.getElementById('productSupplier').value = '';
                document.getElementById('productPurchasePrice').value = '';
                document.getElementById('productSellingPrice').value = '';
                document.getElementById('productDescription').value = '';
                delete document.getElementById('addProductModal').dataset.editId;
            }
            document.getElementById('addProductModal').style.display = 'block';
        }
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // Product CRUD
        function addProduct() {
            // Validation
            const name = document.getElementById('productName').value.trim();
            const brand = document.getElementById('productBrand').value.trim();
            const model = document.getElementById('productModel').value.trim();
            const category = document.getElementById('productCategory').value;
            const quantity = parseInt(document.getElementById('productQuantity').value);
            const supplier = document.getElementById('productSupplier').value;
            const purchasePrice = parseFloat(document.getElementById('productPurchasePrice').value);
            const sellingPrice = parseFloat(document.getElementById('productSellingPrice').value);
            const description = document.getElementById('productDescription').value.trim();

            if (!name || !brand || !category || isNaN(quantity) || quantity < 0 || !supplier || isNaN(purchasePrice) || isNaN(sellingPrice)) {
                alert('Please fill all required fields with valid values.');
                return;
            }
            if (sellingPrice < purchasePrice) {
                alert('Selling price must be greater than purchase price.');
                return;
            }
            // Duplicate prevention
            if (!document.getElementById('addProductModal').dataset.editId &&
                products.some(p => p.name.toLowerCase() === name.toLowerCase() && p.brand.toLowerCase() === brand.toLowerCase() && p.model.toLowerCase() === model.toLowerCase())) {
                alert('Duplicate product detected.');
                return;
            }
            // Edit or Add
            const editId = document.getElementById('addProductModal').dataset.editId;
            if (editId) {
                const product = products.find(p => p.id == editId);
                if (product) {
                    product.name = name;
                    product.brand = brand;
                    product.model = model;
                    product.category = category;
                    product.quantity = quantity;
                    product.supplier = supplier;
                    product.purchasePrice = purchasePrice;
                    product.sellingPrice = sellingPrice;
                    product.description = description;
                }
            } else {
                products.push({
                    id: productIdCounter++,
                    name, brand, model, category, quantity, supplier, purchasePrice, sellingPrice, description
                });
            }
            saveData();
            closeModal('addProductModal');
            updateInventoryTable();
            updateDashboard();
            updateSalesDropdown();
        }
        function editProduct(productId) {
            showAddProductModal(productId);
        }
        function deleteProduct(productId) {
            if (!confirm('Are you sure you want to delete this product?')) return;
            products = products.filter(p => p.id !== productId);
            saveData();
            updateInventoryTable();
            updateDashboard();
            updateSalesDropdown();
        }

        // Inventory management
        function updateInventoryTable() {
            const inventoryBody = document.getElementById('inventoryBody');
            inventoryBody.innerHTML = '';
            let filteredProducts = products;
            const search = document.getElementById('productSearch').value?.toLowerCase() || '';
            if (search) {
                filteredProducts = filteredProducts.filter(p =>
                    p.name.toLowerCase().includes(search) ||
                    p.brand.toLowerCase().includes(search) ||
                    p.category.toLowerCase().includes(search)
                );
            }
            filteredProducts.forEach(product => {
                const profit = product.sellingPrice - product.purchasePrice;
                const row = document.createElement('tr');
                if (product.quantity <= 5) row.className = 'low-stock';
                row.innerHTML = `
                    <td>${product.id}</td>
                    <td>${product.name}</td>
                    <td>${product.brand}</td>
                    <td>${product.category}</td>
                    <td>${product.quantity}</td>
                    <td>${product.purchasePrice.toFixed(2)}</td>
                    <td>${product.sellingPrice.toFixed(2)}</td>
                    <td>${profit.toFixed(2)}</td>
                    <td>
                        <button class="btn btn-secondary" onclick="editProduct(${product.id})">Edit</button>
                        <button class="btn btn-danger" onclick="deleteProduct(${product.id})">Delete</button>
                    </td>
                `;
                inventoryBody.appendChild(row);
            });
        }
        function searchProducts() {
            updateInventoryTable();
        }

        // Sales Dropdown
        function updateSalesDropdown() {
            const saleProduct = document.getElementById('saleProduct');
            saleProduct.innerHTML = '<option value="">Choose a product...</option>';
            products.forEach(product => {
                if (product.quantity > 0) {
                    saleProduct.innerHTML += `<option value="${product.id}">${product.name} (${product.brand}) [${product.quantity} in stock]</option>`;
                }
            });
        }
        function updateSalePrice() {
            const productId = parseInt(document.getElementById('saleProduct').value);
            const product = products.find(p => p.id === productId);
            if (product) {
                document.getElementById('salePrice').value = product.sellingPrice;
                document.getElementById('saleQuantity').max = product.quantity;
            } else {
                document.getElementById('salePrice').value = '';
                document.getElementById('saleQuantity').max = '';
            }
            updateSaleTotal();
        }
        function updateSaleTotal() {
            const qty = parseInt(document.getElementById('saleQuantity').value) || 0;
            const price = parseFloat(document.getElementById('salePrice').value) || 0;
            document.getElementById('saleTotal').value = (qty * price).toFixed(2);
        }

        // Sales Processing
        function processSale() {
            const productId = parseInt(document.getElementById('saleProduct').value);
            const quantity = parseInt(document.getElementById('saleQuantity').value);
            const unitPrice = parseFloat(document.getElementById('salePrice').value);
            const totalAmount = parseFloat(document.getElementById('saleTotal').value);
            const customerName = document.getElementById('customerName').value.trim();
            const customerPhone = document.getElementById('customerPhone').value.trim();
            const notes = document.getElementById('saleNotes').value.trim();

            if (!productId || !quantity || !unitPrice || !customerName || !customerPhone) {
                alert('Please fill all required fields.');
                return;
            }
            const product = products.find(p => p.id === productId);
            if (!product || product.quantity < quantity) {
                alert('Insufficient stock.');
                return;
            }
            // Deduct stock
            product.quantity -= quantity;
            // Profit calculation
            const profit = (unitPrice - product.purchasePrice) * quantity;
            // Add sale
            sales.push({
                id: saleIdCounter++,
                productId,
                productName: product.name,
                customerName,
                customerPhone,
                quantity,
                unitPrice,
                totalAmount,
                profit,
                date: new Date().toISOString().split('T')[0],
                notes
            });
            // Add customer if not exists
            let customer = customers.find(c => c.phone === customerPhone);
            if (!customer) {
                customers.push({
                    id: customerIdCounter++,
                    name: customerName,
                    phone: customerPhone,
                    purchaseHistory: []
                });
                customer = customers[customers.length - 1];
            }
            customer.purchaseHistory.push({
                productId,
                productName: product.name,
                quantity,
                totalAmount,
                date: new Date().toISOString().split('T')[0]
            });
            saveData();
            updateDashboard();
            updateInventoryTable();
            updateSalesDropdown();
            alert('Sale completed successfully!');
            // Clear sale form
            document.getElementById('saleProduct').value = '';
            document.getElementById('saleQuantity').value = 1;
            document.getElementById('salePrice').value = '';
            document.getElementById('saleTotal').value = '';
            document.getElementById('customerName').value = '';
            document.getElementById('customerPhone').value = '';
            document.getElementById('saleNotes').value = '';
        }

        // Supplier CRUD
        function showAddSupplierModal(supplierId) {
            if (supplierId) {
                const supplier = suppliers.find(s => s.id === supplierId);
                if (supplier) {
                    document.getElementById('supplierName').value = supplier.name;
                    document.getElementById('supplierContact').value = supplier.contact;
                    document.getElementById('supplierEmail').value = supplier.email;
                    document.getElementById('supplierAddress').value = supplier.address;
                    document.getElementById('supplierProducts').value = supplier.products;
                    document.getElementById('addSupplierModal').dataset.editId = supplierId;
                }
            } else {
                document.getElementById('supplierName').value = '';
                document.getElementById('supplierContact').value = '';
                document.getElementById('supplierEmail').value = '';
                document.getElementById('supplierAddress').value = '';
                document.getElementById('supplierProducts').value = '';
                delete document.getElementById('addSupplierModal').dataset.editId;
            }
            document.getElementById('addSupplierModal').style.display = 'block';
        }
        function addSupplier() {
            const name = document.getElementById('supplierName').value.trim();
            const contact = document.getElementById('supplierContact').value.trim();
            const email = document.getElementById('supplierEmail').value.trim();
            const address = document.getElementById('supplierAddress').value.trim();
            const productsSupplied = document.getElementById('supplierProducts').value.trim();
            if (!name || !contact) {
                alert('Please fill all required fields.');
                return;
            }
            // Duplicate prevention
            if (!document.getElementById('addSupplierModal').dataset.editId &&
                suppliers.some(s => s.name.toLowerCase() === name.toLowerCase() && s.contact === contact)) {
                alert('Duplicate supplier detected.');
                return;
            }
            const editId = document.getElementById('addSupplierModal').dataset.editId;
            if (editId) {
                const supplier = suppliers.find(s => s.id == editId);
                if (supplier) {
                    supplier.name = name;
                    supplier.contact = contact;
                    supplier.email = email;
                    supplier.address = address;
                    supplier.products = productsSupplied;
                }
            } else {
                suppliers.push({
                    id: supplierIdCounter++,
                    name, contact, email, address, products: productsSupplied
                });
            }
            saveData();
            closeModal('addSupplierModal');
            updateSuppliersTable();
            updateSuppliersDropdown();
        }
        function editSupplier(supplierId) {
            showAddSupplierModal(supplierId);
        }
        function deleteSupplier(supplierId) {
            if (!confirm('Are you sure you want to delete this supplier?')) return;
            suppliers = suppliers.filter(s => s.id !== supplierId);
            saveData();
            updateSuppliersTable();
            updateSuppliersDropdown();
        }
        function updateSuppliersTable() {
            const suppliersBody = document.getElementById('suppliersBody');
            suppliersBody.innerHTML = '';
            suppliers.forEach(supplier => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${supplier.name}</td>
                    <td>${supplier.contact}</td>
                    <td>${supplier.email}</td>
                    <td>${supplier.products}</td>
                    <td>
                        <button class="btn btn-secondary" onclick="editSupplier(${supplier.id})">Edit</button>
                        <button class="btn btn-danger" onclick="deleteSupplier(${supplier.id})">Delete</button>
                    </td>
                `;
                suppliersBody.appendChild(row);
            });
        }
        function updateSuppliersDropdown() {
            const supplierSelect = document.getElementById('productSupplier');
            supplierSelect.innerHTML = '<option value="">Select Supplier</option>';
            suppliers.forEach(supplier => {
                supplierSelect.innerHTML += `<option value="${supplier.name}">${supplier.name}</option>`;
            });
        }

        // Dashboard functions
        function updateDashboard() {
            const totalProducts = products.reduce((sum, product) => sum + product.quantity, 0);
            const today = new Date().toISOString().split('T')[0];
            const todaySales = sales.filter(sale => sale.date === today).reduce((sum, sale) => sum + sale.totalAmount, 0);
            const thisMonth = new Date().toISOString().slice(0, 7);
            const monthSales = sales.filter(sale => sale.date.startsWith(thisMonth)).reduce((sum, sale) => sum + sale.totalAmount, 0);
            const totalProfit = sales.reduce((sum, sale) => sum + sale.profit, 0);

            document.getElementById('totalProducts').textContent = totalProducts;
            document.getElementById('todaySales').textContent = `$${todaySales.toFixed(2)}`;
            document.getElementById('monthSales').textContent = `$${monthSales.toFixed(2)}`;
            document.getElementById('totalProfit').textContent = `$${totalProfit.toFixed(2)}`;

            // Recent sales
            const recentSales = sales.slice(-5).reverse();
            const recentSalesBody = document.getElementById('recentSalesBody');
            recentSalesBody.innerHTML = '';
            recentSales.forEach(sale => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${sale.date}</td>
                    <td>${sale.productName}</td>
                    <td>${sale.customerName}</td>
                    <td>${sale.quantity}</td>
                    <td>$${sale.totalAmount.toFixed(2)}</td>
                    <td>$${sale.profit.toFixed(2)}</td>
                `;
                recentSalesBody.appendChild(row);
            });

            // Low stock alerts
            const lowStockProducts = products.filter(product => product.quantity <= 5);
            const lowStockBody = document.getElementById('lowStockBody');
            lowStockBody.innerHTML = '';
            lowStockProducts.forEach(product => {
                const row = document.createElement('tr');
                row.className = 'low-stock';
                row.innerHTML = `
                    <td>${product.name}</td>
                    <td>${product.brand}</td>
                    <td>${product.quantity}</td>
                    <td><button class="btn btn-primary" onclick="showAddProductModal(${product.id})">Restock</button></td>
                `;
                lowStockBody.appendChild(row);
            });
        }

        // Reports
        function generateReport() {
            const type = document.getElementById('reportType').value;
            const date = document.getElementById('reportDate').value;
            let html = '';
            if (type === 'daily') {
                const dailySales = sales.filter(sale => sale.date === date);
                html += `<h3>Daily Sales Report (${date})</h3>`;
                html += `<table><thead><tr><th>Product</th><th>Customer</th><th>Qty</th><th>Amount</th><th>Profit</th></tr></thead><tbody>`;
                dailySales.forEach(sale => {
                    html += `<tr>
                        <td>${sale.productName}</td>
                        <td>${sale.customerName}</td>
                        <td>${sale.quantity}</td>
                        <td>$${sale.totalAmount.toFixed(2)}</td>
                        <td>$${sale.profit.toFixed(2)}</td>
                    </tr>`;
                });
                html += `</tbody></table>`;
                html += `<p>Total Sales: $${dailySales.reduce((sum, s) => sum + s.totalAmount, 0).toFixed(2)}</p>`;
                html += `<p>Total Profit: $${dailySales.reduce((sum, s) => sum + s.profit, 0).toFixed(2)}</p>`;
            } else if (type === 'monthly') {
                const month = date.slice(0, 7);
                const monthlySales = sales.filter(sale => sale.date.startsWith(month));
                html += `<h3>Monthly Sales Report (${month})</h3>`;
                html += `<table><thead><tr><th>Date</th><th>Product</th><th>Customer</th><th>Qty</th><th>Amount</th><th>Profit</th></tr></thead><tbody>`;
                monthlySales.forEach(sale => {
                    html += `<tr>
                        <td>${sale.date}</td>
                        <td>${sale.productName}</td>
                        <td>${sale.customerName}</td>
                        <td>${sale.quantity}</td>
                        <td>$${sale.totalAmount.toFixed(2)}</td>
                        <td>$${sale.profit.toFixed(2)}</td>
                    </tr>`;
                });
                html += `</tbody></table>`;
                html += `<p>Total Sales: $${monthlySales.reduce((sum, s) => sum + s.totalAmount, 0).toFixed(2)}</p>`;
                html += `<p>Total Profit: $${monthlySales.reduce((sum, s) => sum + s.profit, 0).toFixed(2)}</p>`;
            } else if (type === 'yearly') {
                const year = date.slice(0, 4);
                const yearlySales = sales.filter(sale => sale.date.startsWith(year));
                html += `<h3>Yearly Sales Report (${year})</h3>`;
                html += `<table><thead><tr><th>Date</th><th>Product</th><th>Customer</th><th>Qty</th><th>Amount</th><th>Profit</th></tr></thead><tbody>`;
                yearlySales.forEach(sale => {
                    html += `<tr>
                        <td>${sale.date}</td>
                        <td>${sale.productName}</td>
                        <td>${sale.customerName}</td>
                        <td>${sale.quantity}</td>
                        <td>$${sale.totalAmount.toFixed(2)}</td>
                        <td>$${sale.profit.toFixed(2)}</td>
                    </tr>`;
                });
                html += `</tbody></table>`;
                html += `<p>Total Sales: $${yearlySales.reduce((sum, s) => sum + s.totalAmount, 0).toFixed(2)}</p>`;
                html += `<p>Total Profit: $${yearlySales.reduce((sum, s) => sum + s.profit, 0).toFixed(2)}</p>`;
            } else if (type === 'profit') {
                html += `<h3>Profit Analysis</h3>`;
                html += `<table><thead><tr><th>Product</th><th>Total Sold</th><th>Total Profit</th></tr></thead><tbody>`;
                products.forEach(product => {
                    const productSales = sales.filter(sale => sale.productId === product.id);
                    const totalSold = productSales.reduce((sum, s) => sum + s.quantity, 0);
                    const totalProfit = productSales.reduce((sum, s) => sum + s.profit, 0);
                    html += `<tr>
                        <td>${product.name}</td>
                        <td>${totalSold}</td>
                        <td>$${totalProfit.toFixed(2)}</td>
                    </tr>`;
                });
                html += `</tbody></table>`;
            }
            document.getElementById('reportContent').innerHTML = html;
        }
    </script>
</body>

</html>
